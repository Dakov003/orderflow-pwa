<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase & CRUD - OrderFlow PWA</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .content {
            padding: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .test-card:hover {
            border-color: #0ea5e9;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .test-button {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        .test-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .results {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .app-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ Test Firebase & CRUD - OrderFlow PWA</h1>
            <p>TesteazÄƒ integrarea Firebase È™i operaÈ›iunile CRUD</p>
        </div>

        <div class="content">
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ”¥ Firebase Connection</h3>
                    <p>TesteazÄƒ conexiunea la Firebase</p>
                    <button class="test-button" onclick="testFirebaseConnection()">TesteazÄƒ Conexiunea</button>
                    <button class="test-button" onclick="testFirebaseAuth()">TesteazÄƒ Autentificare</button>
                    <div class="results" id="firebaseResults"></div>
                </div>

                <div class="test-card">
                    <h3>ğŸ“Š CRUD Operations</h3>
                    <p>TesteazÄƒ operaÈ›iunile Create, Read, Update, Delete</p>
                    <button class="test-button" onclick="testCreateOperations()">TesteazÄƒ Create</button>
                    <button class="test-button" onclick="testReadOperations()">TesteazÄƒ Read</button>
                    <div class="results" id="crudResults"></div>
                </div>

                <div class="test-card">
                    <h3>ğŸ’¾ LocalStorage Fallback</h3>
                    <p>TesteazÄƒ funcÈ›ionarea fÄƒrÄƒ Firebase</p>
                    <button class="test-button" onclick="testLocalStorageMode()">TesteazÄƒ LocalStorage</button>
                    <button class="test-button" onclick="testDataPersistence()">TesteazÄƒ PersistenÈ›a</button>
                    <div class="results" id="storageResults"></div>
                </div>

                <div class="test-card">
                    <h3>ğŸ”„ Data Sync</h3>
                    <p>TesteazÄƒ sincronizarea datelor</p>
                    <button class="test-button" onclick="testDataSync()">TesteazÄƒ Sincronizare</button>
                    <button class="test-button" onclick="testOfflineSync()">TesteazÄƒ Offline Sync</button>
                    <div class="results" id="syncResults"></div>
                </div>
            </div>

            <div class="test-card">
                <h2>ğŸŒ AplicaÈ›ia OrderFlow</h2>
                <p>TesteazÄƒ operaÈ›iunile CRUD Ã®n aplicaÈ›ia realÄƒ:</p>
                <iframe src="http://localhost:4173" class="app-frame" id="appFrame"></iframe>
            </div>

            <div class="test-card">
                <h2>ğŸ“Š Raport Testare Firebase & CRUD</h2>
                <button class="test-button" onclick="generateFirebaseReport()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    GenereazÄƒ Raport
                </button>
                <div class="results" id="firebaseReport"></div>
            </div>
        </div>
    </div>

    <script>
        let firebaseTestResults = {
            connection: {},
            auth: {},
            crud: {},
            storage: {},
            sync: {}
        };

        function testFirebaseConnection() {
            const results = document.getElementById('firebaseResults');
            let result = 'ğŸ”¥ Testare Conexiune Firebase:\n';
            
            try {
                // VerificÄƒ dacÄƒ Firebase este disponibil
                if (typeof firebase !== 'undefined') {
                    result += 'âœ… Firebase SDK Ã®ncÄƒrcat\n';
                    firebaseTestResults.connection.sdkLoaded = true;
                } else {
                    result += 'âŒ Firebase SDK nu este Ã®ncÄƒrcat\n';
                    firebaseTestResults.connection.sdkLoaded = false;
                }
                
                // VerificÄƒ configuraÈ›ia Firebase
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // CautÄƒ configuraÈ›ia Firebase Ã®n aplicaÈ›ie
                const scripts = iframeDoc.querySelectorAll('script');
                let firebaseConfigFound = false;
                
                scripts.forEach(script => {
                    if (script.textContent.includes('firebaseConfig') || 
                        script.textContent.includes('apiKey')) {
                        firebaseConfigFound = true;
                    }
                });
                
                if (firebaseConfigFound) {
                    result += 'âœ… ConfiguraÈ›ia Firebase gÄƒsitÄƒ\n';
                    firebaseTestResults.connection.configFound = true;
                } else {
                    result += 'âŒ ConfiguraÈ›ia Firebase nu a fost gÄƒsitÄƒ\n';
                    firebaseTestResults.connection.configFound = false;
                }
                
                // TesteazÄƒ conectivitatea la Firebase
                fetch('https://firebase.googleapis.com/v1beta1/projects/order-flow-28c1b', {
                    method: 'GET',
                    mode: 'no-cors'
                }).then(() => {
                    result += 'âœ… Conectivitate Firebase OK\n';
                    firebaseTestResults.connection.connectivity = true;
                }).catch(() => {
                    result += 'âš ï¸ Conectivitate Firebase incertÄƒ\n';
                    firebaseTestResults.connection.connectivity = false;
                }).finally(() => {
                    results.innerHTML = result;
                });
                
            } catch (error) {
                result += `âŒ Eroare la testarea conexiunii Firebase: ${error.message}\n`;
                firebaseTestResults.connection.error = error.message;
                results.innerHTML = result;
            }
        }

        function testFirebaseAuth() {
            const results = document.getElementById('firebaseResults');
            let result = results.innerHTML + '\n\nğŸ” Testare Autentificare Firebase:\n';
            
            try {
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // VerificÄƒ dacÄƒ existÄƒ elemente de autentificare
                const authElements = iframeDoc.querySelectorAll('[data-auth], [class*="auth"], [id*="auth"]');
                result += `âœ… Elemente de autentificare gÄƒsite: ${authElements.length}\n`;
                firebaseTestResults.auth.elementsCount = authElements.length;
                
                // VerificÄƒ dacÄƒ existÄƒ butoane de login/logout
                const loginButtons = iframeDoc.querySelectorAll('button:contains("Login"), button:contains("Logout"), button:contains("Sign")');
                result += `âœ… Butoane auth gÄƒsite: ${loginButtons.length}\n`;
                firebaseTestResults.auth.buttonsCount = loginButtons.length;
                
                // VerificÄƒ localStorage pentru token-uri
                const authKeys = Object.keys(localStorage).filter(key => 
                    key.includes('auth') || key.includes('token') || key.includes('user')
                );
                result += `âœ… Chei auth Ã®n localStorage: ${authKeys.length}\n`;
                firebaseTestResults.auth.localStorageKeys = authKeys.length;
                
                if (authKeys.length > 0) {
                    result += `  Chei gÄƒsite: ${authKeys.join(', ')}\n`;
                }
                
            } catch (error) {
                result += `âŒ Eroare la testarea autentificÄƒrii: ${error.message}\n`;
                firebaseTestResults.auth.error = error.message;
            }
            
            results.innerHTML = result;
        }

        function testCreateOperations() {
            const results = document.getElementById('crudResults');
            let result = 'ğŸ“Š Testare OperaÈ›iuni Create:\n';
            
            try {
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // TesteazÄƒ formularele de creare
                const forms = iframeDoc.querySelectorAll('form');
                result += `âœ… Formulare gÄƒsite: ${forms.length}\n`;
                firebaseTestResults.crud.formsCount = forms.length;
                
                // TesteazÄƒ butoanele de adÄƒugare
                const addButtons = iframeDoc.querySelectorAll('button');
                const createButtons = Array.from(addButtons).filter(btn => 
                    btn.textContent.includes('AdaugÄƒ') || 
                    btn.textContent.includes('CreeazÄƒ') || 
                    btn.textContent.includes('SalveazÄƒ') ||
                    btn.textContent.includes('Add') ||
                    btn.textContent.includes('Create')
                );
                result += `âœ… Butoane create gÄƒsite: ${createButtons.length}\n`;
                firebaseTestResults.crud.createButtons = createButtons.length;
                
                // TesteazÄƒ input-urile pentru creare
                const inputs = iframeDoc.querySelectorAll('input');
                result += `âœ… Input-uri pentru creare: ${inputs.length}\n`;
                firebaseTestResults.crud.inputsCount = inputs.length;
                
                // TesteazÄƒ validarea formularelor
                const requiredInputs = iframeDoc.querySelectorAll('input[required]');
                result += `âœ… Input-uri obligatorii: ${requiredInputs.length}\n`;
                firebaseTestResults.crud.requiredInputs = requiredInputs.length;
                
            } catch (error) {
                result += `âŒ Eroare la testarea operaÈ›iunilor create: ${error.message}\n`;
                firebaseTestResults.crud.createError = error.message;
            }
            
            results.innerHTML = result;
        }

        function testReadOperations() {
            const results = document.getElementById('crudResults');
            let result = results.innerHTML + '\n\nğŸ“– Testare OperaÈ›iuni Read:\n';
            
            try {
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // TesteazÄƒ tabelele pentru afiÈ™are date
                const tables = iframeDoc.querySelectorAll('table');
                result += `âœ… Tabele pentru afiÈ™are: ${tables.length}\n`;
                firebaseTestResults.crud.tablesCount = tables.length;
                
                // TesteazÄƒ listele
                const lists = iframeDoc.querySelectorAll('ul, ol');
                result += `âœ… Liste pentru afiÈ™are: ${lists.length}\n`;
                firebaseTestResults.crud.listsCount = lists.length;
                
                // TesteazÄƒ card-urile
                const cards = iframeDoc.querySelectorAll('[class*="card"], [class*="bg-white"]');
                result += `âœ… Card-uri pentru afiÈ™are: ${cards.length}\n`;
                firebaseTestResults.crud.cardsCount = cards.length;
                
                // TesteazÄƒ butoanele de refresh
                const refreshButtons = Array.from(iframeDoc.querySelectorAll('button')).filter(btn => 
                    btn.textContent.includes('Refresh') || 
                    btn.textContent.includes('ActualizeazÄƒ') ||
                    btn.querySelector('svg[data-lucide="refresh"]')
                );
                result += `âœ… Butoane refresh: ${refreshButtons.length}\n`;
                firebaseTestResults.crud.refreshButtons = refreshButtons.length;
                
            } catch (error) {
                result += `âŒ Eroare la testarea operaÈ›iunilor read: ${error.message}\n`;
                firebaseTestResults.crud.readError = error.message;
            }
            
            results.innerHTML = result;
        }

        function testLocalStorageMode() {
            const results = document.getElementById('storageResults');
            let result = 'ğŸ’¾ Testare Mod LocalStorage:\n';
            
            try {
                // TesteazÄƒ localStorage
                const testKey = 'test_crud_' + Date.now();
                const testData = { name: 'Test', value: Math.random() };
                
                localStorage.setItem(testKey, JSON.stringify(testData));
                const retrievedData = JSON.parse(localStorage.getItem(testKey));
                
                if (retrievedData.name === testData.name) {
                    result += 'âœ… LocalStorage funcÈ›ioneazÄƒ pentru date complexe\n';
                    firebaseTestResults.storage.localStorageWorking = true;
                } else {
                    result += 'âŒ LocalStorage nu funcÈ›ioneazÄƒ pentru date complexe\n';
                    firebaseTestResults.storage.localStorageWorking = false;
                }
                
                localStorage.removeItem(testKey);
                
                // VerificÄƒ cheile existente Ã®n localStorage
                const existingKeys = Object.keys(localStorage);
                const appKeys = existingKeys.filter(key => key.includes('orderflow'));
                result += `âœ… Chei aplicaÈ›ie Ã®n localStorage: ${appKeys.length}\n`;
                firebaseTestResults.storage.appKeys = appKeys.length;
                
                if (appKeys.length > 0) {
                    result += `  Chei gÄƒsite: ${appKeys.join(', ')}\n`;
                }
                
                // TesteazÄƒ capacitatea localStorage
                let storageSize = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        storageSize += localStorage[key].length;
                    }
                }
                result += `â„¹ï¸ SpaÈ›iu folosit: ${(storageSize / 1024).toFixed(2)} KB\n`;
                firebaseTestResults.storage.usedSpace = storageSize;
                
            } catch (error) {
                result += `âŒ Eroare la testarea localStorage: ${error.message}\n`;
                firebaseTestResults.storage.error = error.message;
            }
            
            results.innerHTML = result;
        }

        function testDataPersistence() {
            const results = document.getElementById('storageResults');
            let result = results.innerHTML + '\n\nğŸ’¾ Testare PersistenÈ›a Datelor:\n';
            
            try {
                // TesteazÄƒ dacÄƒ datele se pÄƒstreazÄƒ Ã®ntre sesiuni
                const testKey = 'persistence_test';
                const testValue = 'test_value_' + Date.now();
                
                localStorage.setItem(testKey, testValue);
                const retrievedValue = localStorage.getItem(testKey);
                
                if (retrievedValue === testValue) {
                    result += 'âœ… Datele se pÄƒstreazÄƒ Ã®n localStorage\n';
                    firebaseTestResults.storage.persistence = true;
                } else {
                    result += 'âŒ Datele nu se pÄƒstreazÄƒ Ã®n localStorage\n';
                    firebaseTestResults.storage.persistence = false;
                }
                
                // TesteazÄƒ sessionStorage
                sessionStorage.setItem(testKey, testValue);
                const sessionValue = sessionStorage.getItem(testKey);
                
                if (sessionValue === testValue) {
                    result += 'âœ… Datele se pÄƒstreazÄƒ Ã®n sessionStorage\n';
                    firebaseTestResults.storage.sessionPersistence = true;
                } else {
                    result += 'âŒ Datele nu se pÄƒstreazÄƒ Ã®n sessionStorage\n';
                    firebaseTestResults.storage.sessionPersistence = false;
                }
                
                // CurÄƒÈ›Äƒ testele
                localStorage.removeItem(testKey);
                sessionStorage.removeItem(testKey);
                
            } catch (error) {
                result += `âŒ Eroare la testarea persistenÈ›ei: ${error.message}\n`;
            }
            
            results.innerHTML = result;
        }

        function testDataSync() {
            const results = document.getElementById('syncResults');
            let result = 'ğŸ”„ Testare Sincronizare Date:\n';
            
            try {
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // VerificÄƒ dacÄƒ existÄƒ mecanisme de sincronizare
                const syncElements = iframeDoc.querySelectorAll('[class*="sync"], [data-sync], [id*="sync"]');
                result += `âœ… Elemente de sincronizare: ${syncElements.length}\n`;
                firebaseTestResults.sync.elementsCount = syncElements.length;
                
                // VerificÄƒ butoanele de sincronizare
                const syncButtons = Array.from(iframeDoc.querySelectorAll('button')).filter(btn => 
                    btn.textContent.includes('Sync') || 
                    btn.textContent.includes('SincronizeazÄƒ') ||
                    btn.textContent.includes('ActualizeazÄƒ')
                );
                result += `âœ… Butoane sincronizare: ${syncButtons.length}\n`;
                firebaseTestResults.sync.buttonsCount = syncButtons.length;
                
                // VerificÄƒ indicatorii de status
                const statusIndicators = iframeDoc.querySelectorAll('[class*="status"], [class*="indicator"]');
                result += `âœ… Indicatori status: ${statusIndicators.length}\n`;
                firebaseTestResults.sync.statusIndicators = statusIndicators.length;
                
            } catch (error) {
                result += `âŒ Eroare la testarea sincronizÄƒrii: ${error.message}\n`;
                firebaseTestResults.sync.error = error.message;
            }
            
            results.innerHTML = result;
        }

        function testOfflineSync() {
            const results = document.getElementById('syncResults');
            let result = results.innerHTML + '\n\nğŸ“¡ Testare Sincronizare Offline:\n';
            
            try {
                // SimuleazÄƒ offline
                const originalFetch = window.fetch;
                window.fetch = function() {
                    return Promise.reject(new Error('Simulated offline'));
                };
                
                result += 'ğŸ”§ Simulare offline activatÄƒ\n';
                
                // TesteazÄƒ dacÄƒ aplicaÈ›ia funcÈ›ioneazÄƒ offline
                const iframe = document.getElementById('appFrame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const app = iframeDoc.querySelector('#root');
                if (app && app.children.length > 0) {
                    result += 'âœ… AplicaÈ›ia funcÈ›ioneazÄƒ offline\n';
                    firebaseTestResults.sync.offlineWorking = true;
                } else {
                    result += 'âŒ AplicaÈ›ia nu funcÈ›ioneazÄƒ offline\n';
                    firebaseTestResults.sync.offlineWorking = false;
                }
                
                // RestaureazÄƒ fetch-ul normal
                window.fetch = originalFetch;
                result += 'ğŸ”§ Simulare offline dezactivatÄƒ\n';
                
            } catch (error) {
                result += `âŒ Eroare la testarea sincronizÄƒrii offline: ${error.message}\n`;
            }
            
            results.innerHTML = result;
        }

        function generateFirebaseReport() {
            const results = document.getElementById('firebaseReport');
            let report = 'ğŸ“Š RAPORT TESTARE FIREBASE & CRUD - ORDERFLOW PWA\n';
            report += '='.repeat(60) + '\n\n';
            
            report += `ğŸ“… Data: ${new Date().toLocaleString('ro-RO')}\n`;
            report += `ğŸ–¥ï¸ Browser: ${navigator.userAgent}\n`;
            report += `ğŸ“± RezoluÈ›ie: ${window.innerWidth}x${window.innerHeight}\n\n`;
            
            report += 'ğŸ“Š REZULTATE TESTE:\n';
            report += '-'.repeat(30) + '\n';
            
            // Firebase Connection
            report += '\nğŸ”¥ FIREBASE CONNECTION:\n';
            report += `SDK Ã®ncÄƒrcat: ${firebaseTestResults.connection.sdkLoaded ? 'âœ…' : 'âŒ'}\n`;
            report += `Config gÄƒsitÄƒ: ${firebaseTestResults.connection.configFound ? 'âœ…' : 'âŒ'}\n`;
            report += `Conectivitate: ${firebaseTestResults.connection.connectivity ? 'âœ…' : 'âŒ'}\n`;
            
            // Auth
            report += '\nğŸ” AUTHENTICATION:\n';
            report += `Elemente auth: ${firebaseTestResults.auth.elementsCount || 0}\n`;
            report += `Butoane auth: ${firebaseTestResults.auth.buttonsCount || 0}\n`;
            report += `Chei localStorage: ${firebaseTestResults.auth.localStorageKeys || 0}\n`;
            
            // CRUD
            report += '\nğŸ“Š CRUD OPERATIONS:\n';
            report += `Formulare: ${firebaseTestResults.crud.formsCount || 0}\n`;
            report += `Butoane create: ${firebaseTestResults.crud.createButtons || 0}\n`;
            report += `Input-uri: ${firebaseTestResults.crud.inputsCount || 0}\n`;
            report += `Tabele: ${firebaseTestResults.crud.tablesCount || 0}\n`;
            
            // Storage
            report += '\nğŸ’¾ STORAGE:\n';
            report += `LocalStorage funcÈ›ional: ${firebaseTestResults.storage.localStorageWorking ? 'âœ…' : 'âŒ'}\n`;
            report += `Chei aplicaÈ›ie: ${firebaseTestResults.storage.appKeys || 0}\n`;
            report += `PersistenÈ›Äƒ: ${firebaseTestResults.storage.persistence ? 'âœ…' : 'âŒ'}\n`;
            report += `SpaÈ›iu folosit: ${firebaseTestResults.storage.usedSpace ? (firebaseTestResults.storage.usedSpace / 1024).toFixed(2) + ' KB' : 'N/A'}\n`;
            
            // Sync
            report += '\nğŸ”„ SYNC:\n';
            report += `Elemente sync: ${firebaseTestResults.sync.elementsCount || 0}\n`;
            report += `Butoane sync: ${firebaseTestResults.sync.buttonsCount || 0}\n`;
            report += `FuncÈ›ioneazÄƒ offline: ${firebaseTestResults.sync.offlineWorking ? 'âœ…' : 'âŒ'}\n`;
            
            report += '\nğŸ¯ RECOMANDÄ‚RI:\n';
            report += '-'.repeat(20) + '\n';
            report += '1. VerificÄƒ cÄƒ Firebase este configurat corect\n';
            report += '2. TesteazÄƒ operaÈ›iunile CRUD Ã®n condiÈ›ii reale\n';
            report += '3. VerificÄƒ cÄƒ datele se sincronizeazÄƒ corect\n';
            report += '4. TesteazÄƒ funcÈ›ionarea offline\n';
            report += '5. VerificÄƒ cÄƒ fallback-ul la localStorage funcÈ›ioneazÄƒ\n';
            
            results.innerHTML = report;
        }
    </script>
</body>
</html>
