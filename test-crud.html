<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test CRUD OrderFlow</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .test-result { font-weight: bold; margin: 10px 0; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; width: 200px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Test CRUD Operations - OrderFlow PWA</h1>
    
    <div class="test-section">
        <h2>1. Test Gestiune Clienți</h2>
        <div>
            <input type="text" id="customerName" placeholder="Nume client" />
            <input type="text" id="customerPhone" placeholder="Telefon" />
            <input type="text" id="customerNotes" placeholder="Notițe" />
            <button onclick="addCustomer()">Adaugă Client</button>
            <button onclick="testCustomerCRUD()">Testează CRUD Clienți</button>
        </div>
        <div id="customer-results"></div>
        <table id="customers-table">
            <thead>
                <tr><th>ID</th><th>Nume</th><th>Telefon</th><th>Notițe</th><th>Acțiuni</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div class="test-section">
        <h2>2. Test Gestiune Produse</h2>
        <div>
            <input type="text" id="productName" placeholder="Nume produs" />
            <input type="number" id="productPrice" placeholder="Preț" step="0.01" />
            <button onclick="addProduct()">Adaugă Produs</button>
            <button onclick="testProductCRUD()">Testează CRUD Produse</button>
        </div>
        <div id="product-results"></div>
        <table id="products-table">
            <thead>
                <tr><th>ID</th><th>Nume</th><th>Preț</th><th>Acțiuni</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div class="test-section">
        <h2>3. Test Gestiune Comenzi</h2>
        <div>
            <select id="orderCustomer">
                <option value="">Selectează client</option>
            </select>
            <button onclick="addOrder()">Creează Comandă</button>
            <button onclick="testOrderCRUD()">Testează CRUD Comenzi</button>
        </div>
        <div id="order-results"></div>
        <table id="orders-table">
            <thead>
                <tr><th>ID</th><th>Client</th><th>Status</th><th>Total</th><th>Acțiuni</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // Simulare localStorage pentru teste
        const mockStorage = {
            data: {},
            getItem: function(key) {
                return this.data[key] || null;
            },
            setItem: function(key, value) {
                this.data[key] = value;
            },
            clear: function() {
                this.data = {};
            }
        };
        
        // Override localStorage pentru teste
        Object.defineProperty(window, 'localStorage', {
            value: mockStorage,
            writable: true
        });
        
        // Funcții helper
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function createTimestamp() {
            return { toDate: () => new Date() };
        }
        
        function formatCurrency(amount) {
            const numberAmount = typeof amount === 'number' ? amount : parseFloat(amount || 0);
            if (isNaN(numberAmount)) {
                return new Intl.NumberFormat('ro-RO', { style: 'currency', currency: 'RON' }).format(0);
            }
            return new Intl.NumberFormat('ro-RO', { style: 'currency', currency: 'RON' }).format(numberAmount);
        }
        
        // Funcții pentru clienți
        let customers = [];
        
        function addCustomer() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const notes = document.getElementById('customerNotes').value;
            
            if (!name.trim()) {
                alert('Numele este obligatoriu!');
                return;
            }
            
            const customer = {
                id: generateId(),
                name: name.trim(),
                phone: phone.trim(),
                notes: notes.trim(),
                createdAt: createTimestamp()
            };
            
            customers.push(customer);
            localStorage.setItem('orderflow_customers', JSON.stringify(customers));
            updateCustomersTable();
            updateCustomerSelect();
            
            // Clear form
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerNotes').value = '';
        }
        
        function updateCustomersTable() {
            const tbody = document.querySelector('#customers-table tbody');
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${customer.id.substring(0, 8)}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone || '-'}</td>
                    <td>${customer.notes || '-'}</td>
                    <td>
                        <button onclick="editCustomer('${customer.id}')">Edit</button>
                        <button onclick="deleteCustomer('${customer.id}')">Delete</button>
                    </td>
                `;
            });
        }
        
        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('customerPhone').value = customer.phone || '';
                document.getElementById('customerNotes').value = customer.notes || '';
            }
        }
        
        function deleteCustomer(id) {
            if (confirm('Ești sigur că vrei să ștergi acest client?')) {
                customers = customers.filter(c => c.id !== id);
                localStorage.setItem('orderflow_customers', JSON.stringify(customers));
                updateCustomersTable();
                updateCustomerSelect();
            }
        }
        
        function updateCustomerSelect() {
            const select = document.getElementById('orderCustomer');
            select.innerHTML = '<option value="">Selectează client</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                select.appendChild(option);
            });
        }
        
        // Funcții pentru produse
        let products = [];
        
        function addProduct() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            
            if (!name.trim() || isNaN(price) || price <= 0) {
                alert('Numele și prețul valid sunt obligatorii!');
                return;
            }
            
            const product = {
                id: generateId(),
                name: name.trim(),
                price: price,
                createdAt: createTimestamp()
            };
            
            products.push(product);
            localStorage.setItem('orderflow_products', JSON.stringify(products));
            updateProductsTable();
            
            // Clear form
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
        }
        
        function updateProductsTable() {
            const tbody = document.querySelector('#products-table tbody');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${product.id.substring(0, 8)}</td>
                    <td>${product.name}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>
                        <button onclick="editProduct('${product.id}')">Edit</button>
                        <button onclick="deleteProduct('${product.id}')">Delete</button>
                    </td>
                `;
            });
        }
        
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
            }
        }
        
        function deleteProduct(id) {
            if (confirm('Ești sigur că vrei să ștergi acest produs?')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('orderflow_products', JSON.stringify(products));
                updateProductsTable();
            }
        }
        
        // Funcții pentru comenzi
        let orders = [];
        
        function addOrder() {
            const customerId = document.getElementById('orderCustomer').value;
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                alert('Selectează un client!');
                return;
            }
            
            const order = {
                id: generateId(),
                customerId: customerId,
                customerName: customer.name,
                items: [],
                totalAmount: 0,
                paidAmount: 0,
                status: 'Deschisă',
                createdAt: createTimestamp()
            };
            
            orders.push(order);
            localStorage.setItem('orderflow_orders', JSON.stringify(orders));
            updateOrdersTable();
        }
        
        function updateOrdersTable() {
            const tbody = document.querySelector('#orders-table tbody');
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${order.id.substring(0, 8)}</td>
                    <td>${order.customerName}</td>
                    <td>${order.status}</td>
                    <td>${formatCurrency(order.totalAmount)}</td>
                    <td>
                        <button onclick="editOrder('${order.id}')">Edit</button>
                        <button onclick="deleteOrder('${order.id}')">Delete</button>
                    </td>
                `;
            });
        }
        
        function editOrder(id) {
            const order = orders.find(o => o.id === id);
            if (order) {
                document.getElementById('orderCustomer').value = order.customerId;
            }
        }
        
        function deleteOrder(id) {
            if (confirm('Ești sigur că vrei să ștergi această comandă?')) {
                orders = orders.filter(o => o.id !== id);
                localStorage.setItem('orderflow_orders', JSON.stringify(orders));
                updateOrdersTable();
            }
        }
        
        // Funcții de test
        function testCustomerCRUD() {
            const results = document.getElementById('customer-results');
            let tests = [];
            
            // Test 1: Adăugare client
            const initialCount = customers.length;
            const testCustomer = {
                id: generateId(),
                name: 'Test Client',
                phone: '123456789',
                notes: 'Test notes',
                createdAt: createTimestamp()
            };
            customers.push(testCustomer);
            tests.push({
                name: 'Adăugare client',
                passed: customers.length === initialCount + 1
            });
            
            // Test 2: Căutare client
            const foundCustomer = customers.find(c => c.name === 'Test Client');
            tests.push({
                name: 'Căutare client',
                passed: foundCustomer !== undefined
            });
            
            // Test 3: Actualizare client
            if (foundCustomer) {
                foundCustomer.phone = '987654321';
                const updatedCustomer = customers.find(c => c.id === foundCustomer.id);
                tests.push({
                    name: 'Actualizare client',
                    passed: updatedCustomer.phone === '987654321'
                });
            }
            
            // Test 4: Ștergere client
            const deleteCount = customers.length;
            customers = customers.filter(c => c.id !== testCustomer.id);
            tests.push({
                name: 'Ștergere client',
                passed: customers.length === deleteCount - 1
            });
            
            displayResults(results, tests);
        }
        
        function testProductCRUD() {
            const results = document.getElementById('product-results');
            let tests = [];
            
            // Test 1: Adăugare produs
            const initialCount = products.length;
            const testProduct = {
                id: generateId(),
                name: 'Test Product',
                price: 99.99,
                createdAt: createTimestamp()
            };
            products.push(testProduct);
            tests.push({
                name: 'Adăugare produs',
                passed: products.length === initialCount + 1
            });
            
            // Test 2: Căutare produs
            const foundProduct = products.find(p => p.name === 'Test Product');
            tests.push({
                name: 'Căutare produs',
                passed: foundProduct !== undefined
            });
            
            // Test 3: Actualizare produs
            if (foundProduct) {
                foundProduct.price = 149.99;
                const updatedProduct = products.find(p => p.id === foundProduct.id);
                tests.push({
                    name: 'Actualizare produs',
                    passed: updatedProduct.price === 149.99
                });
            }
            
            // Test 4: Ștergere produs
            const deleteCount = products.length;
            products = products.filter(p => p.id !== testProduct.id);
            tests.push({
                name: 'Ștergere produs',
                passed: products.length === deleteCount - 1
            });
            
            displayResults(results, tests);
        }
        
        function testOrderCRUD() {
            const results = document.getElementById('order-results');
            let tests = [];
            
            // Test 1: Adăugare comandă
            const initialCount = orders.length;
            const testOrder = {
                id: generateId(),
                customerId: customers[0]?.id || 'test',
                customerName: customers[0]?.name || 'Test Customer',
                items: [],
                totalAmount: 0,
                paidAmount: 0,
                status: 'Deschisă',
                createdAt: createTimestamp()
            };
            orders.push(testOrder);
            tests.push({
                name: 'Adăugare comandă',
                passed: orders.length === initialCount + 1
            });
            
            // Test 2: Căutare comandă
            const foundOrder = orders.find(o => o.customerName === 'Test Customer');
            tests.push({
                name: 'Căutare comandă',
                passed: foundOrder !== undefined
            });
            
            // Test 3: Actualizare comandă
            if (foundOrder) {
                foundOrder.status = 'Plătită Integral';
                const updatedOrder = orders.find(o => o.id === foundOrder.id);
                tests.push({
                    name: 'Actualizare comandă',
                    passed: updatedOrder.status === 'Plătită Integral'
                });
            }
            
            // Test 4: Ștergere comandă
            const deleteCount = orders.length;
            orders = orders.filter(o => o.id !== testOrder.id);
            tests.push({
                name: 'Ștergere comandă',
                passed: orders.length === deleteCount - 1
            });
            
            displayResults(results, tests);
        }
        
        function displayResults(container, tests) {
            let html = '<div class="test-results">';
            
            tests.forEach(test => {
                const className = test.passed ? 'pass' : 'fail';
                const status = test.passed ? 'PASS' : 'FAIL';
                
                html += `<div class="test-result ${className}">`;
                html += `<strong>${test.name}: ${status}</strong>`;
                html += '</div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Încarcă datele la pornire
        window.addEventListener('load', function() {
            // Încarcă clienți
            const savedCustomers = localStorage.getItem('orderflow_customers');
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
                updateCustomersTable();
                updateCustomerSelect();
            }
            
            // Încarcă produse
            const savedProducts = localStorage.getItem('orderflow_products');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
                updateProductsTable();
            }
            
            // Încarcă comenzi
            const savedOrders = localStorage.getItem('orderflow_orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
                updateOrdersTable();
            }
        });
    </script>
</body>
</html>
